<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Mongo 2</title>

  

  <meta name="viewport" content="width=device-width">
  <!-- Twitter bootstrap basic styles -->
  <link rel="stylesheet" href="../bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="../bootstrap/css/bootstrap-responsive.css">



  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="../css/syntax.css">
  <!-- Google webfont link -->
<link href='http://fonts.googleapis.com/css?family=Arvo:700|Titillium+Web:900' rel='stylesheet' type='text/css'>


  <!-- Custom CSS -->
  <link rel="stylesheet" href="../css/main.css">

  <script src="../assets/jquery-1.10.0.js"></script>

  <script type="text/javascript" src='../bootstrap/js/bootstrap.js'></script>
  <script type="text/javascript" src='../assets/custom.js'></script>

<body class="">

  <div class="container">

    <div class="page-header">
  <h1>Mongo 2 <small>Sending emails</small></h1>
</div>

<div class="tabbable tabs-left">
<ul class="nav nav-tabs" id="myTab">
	
		
		<li class="active"><a href="#1_email" data-toggle="tab">Sending email </a></li>
		
	
		
		<li><a href="#1_introducing_hash" data-toggle="tab">Hashes </a></li>
		
	
		
		<li><a href="#2_configuration_variables" data-toggle="tab">Configuration variables </a></li>
		
	
		
		<li><a href="#2_hashes" data-toggle="tab">More about hashes </a></li>
		
	
		
		<li><a href="#3_email_templates" data-toggle="tab">Email templates </a></li>
		
	
		
		<li><a href="#3_hash_array_conversion" data-toggle="tab">Arrays and back </a></li>
		
	
		
		<li><a href="#4_project" data-toggle="tab">Project </a></li>
		
	
		
		<li><a href="#4_symbols" data-toggle="tab">Symbols </a></li>
		
	
		
		<li><a href="#5_wrapping_up" data-toggle="tab">Rounding up </a></li>
		
	
</ul>

<div class="tab-content">

	
	<div class="tab-pane active" id="1_email">
	

		<h2>Sending email</h2>
		
<p>Today we’ll be looking at sending email from a ruby program. To do this we’ll be using a library called <a href="https://github.com/benprew/pony">Pony</a>. Pony is a light-weight, simple library (in comparison more fully fledged options like <a href="http://guides.rubyonrails.org/action_mailer_basics.html">ActionMailer</a>). After a small amount of configuration, it allows you to send emails with a single function call.</p>

<p>We’ll be using a google account to send the email - you will need to input your username and password, and it will look like the email came from your gmail account. Using gmail is a good solution for a small test app like this. When you get bigger you will start hitting gmails sending limits, and you will want to investigate other solutions e.g. <a href="http://sendgrid.com/">sendgrid</a> or <a href="http://mandrill.com/">mandrill</a>. For further options see the <a href="https://addons.heroku.com/">heroku addons page</a>.</p>

<p>Before sending an email we need to set up some configuration. We do this by setting the <code>Pony.options</code> hash:</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>Pony</span><span class='o'>.</span><span class='n'>options</span> <span class='o'>=</span> <span class='p'>{</span>
  <span class='ss'>:via</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;smtp&#39;</span><span class='p'>,</span>
  <span class='ss'>:via_options</span> <span class='o'>=&gt;</span> <span class='p'>{</span>
    <span class='ss'>:address</span>              <span class='o'>=&gt;</span> <span class='s1'>&#39;smtp.gmail.com&#39;</span><span class='p'>,</span>
    <span class='ss'>:port</span>                 <span class='o'>=&gt;</span> <span class='s1'>&#39;587&#39;</span><span class='p'>,</span>
    <span class='ss'>:enable_starttls_auto</span> <span class='o'>=&gt;</span> <span class='kp'>true</span><span class='p'>,</span>
    <span class='ss'>:user_name</span>            <span class='o'>=&gt;</span> <span class='s1'>&#39;yourusername&#39;</span><span class='p'>,</span>
    <span class='ss'>:password</span>             <span class='o'>=&gt;</span> <span class='s1'>&#39;yourpassword&#39;</span><span class='p'>,</span>
    <span class='ss'>:authentication</span>       <span class='o'>=&gt;</span> <span class='ss'>:plain</span><span class='p'>,</span> <span class='c1'># :plain, :login, :cram_md5, no auth by default</span>
    <span class='ss'>:domain</span>               <span class='o'>=&gt;</span> <span class='s2'>&quot;localhost.localdomain&quot;</span> <span class='c1'># the HELO domain provided by the client to the server</span>
  <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>To send the email is then very simple:</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>Pony</span><span class='o'>.</span><span class='n'>mail</span><span class='p'>(</span><span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;example@example.com&#39;</span><span class='p'>,</span> <span class='ss'>:subject</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;Wow - an email&quot;</span><span class='p'>,</span> <span class='ss'>:body</span><span class='o'>=&gt;</span><span class='s2'>&quot;Hi. This is your program speaking. Bye.&quot;</span><span class='p'>)</span>
</code></pre></div>
<p>You can find out more about the different options you can use on the <a href="https://github.com/benprew/pony">pony github page</a>.</p>
<div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>
<p>If you don&#39;t already have one create a <a href='https://mail.google.com/mail/'>Gmail account</a>.</p>
</li>

<li>
<p>Clone the example email code:</p>

<pre><code> $ git clone https://github.com/code61/email1.git</code></pre>
</li>

<li>
<p>Install the pony gem</p>

<pre><code> $ cd email1
 $ bundle install</code></pre>
</li>

<li>
<p>Check you understand how the configuration is working in the example (it isn&#39;t exactly like the example above).</p>
</li>

<li>
<p>Run the program, follow the instructions and check that you receive the email:</p>

<pre><code> $ ruby email.rb</code></pre>
</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="1_introducing_hash">
	

		<h2>Hashes</h2>
		
<p>A <code>Hash</code> is ruby’s basic <em>key-value store</em>: a place where you can store values, and look them up by a key. The <code>Hash</code> and the <code>Array</code> are ruby’s two common ways of storing a collection of objects. The key differences between ‘Hash’ and ‘Array’ are:</p>

<ul>
<li>In an <code>Array</code> objects are stored in order. You can think of an <code>Array</code> as a list.</li>

<li>In an <code>Array</code> we reference objects by a numerical index.</li>

<li>In a <code>Hash</code> there is no order on the objects. You can think of a <code>Hash</code> as a general collection.</li>

<li>In a <code>Hash</code> objects are referenced by a <code>key</code>. The key can be a number or a word (or several other things).</li>
</ul>

<p>Here is an example of a simple hash:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>character</span> <span class='o'>=</span> <span class='p'>{</span><span class='s1'>&#39;name&#39;</span><span class='o'>=&gt;</span><span class='s1'>&#39;Bart&#39;</span><span class='p'>,</span> <span class='s1'>&#39;surname&#39;</span><span class='o'>=&gt;</span><span class='s1'>&#39;Simpson&#39;</span><span class='p'>,</span> <span class='s1'>&#39;age&#39;</span><span class='o'>=&gt;</span> <span class='mi'>10</span><span class='p'>,</span> <span class='s1'>&#39;catchphrase&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;Eat my shorts&#39;</span><span class='p'>}</span>

<span class='n'>character</span><span class='o'>[</span><span class='s1'>&#39;name&#39;</span><span class='o'>]</span> <span class='c1'>#=&gt; &#39;Bart&#39;</span>
<span class='n'>character</span><span class='o'>[</span><span class='s1'>&#39;catchphrase&#39;</span><span class='o'>]</span> <span class='c1'>#=&gt; &#39;Eat my shorts&#39;</span>
</code></pre></div>
<p>In particular:</p>

<ul>
<li>You write a <code>Hash</code> using the curly brackets <code>{ }</code>.</li>

<li>Each element of the hash has a key e.g. <code>&#39;name&#39;</code> and a value e.g. <code>&#39;Bart&#39;</code>.</li>

<li>When you write the hash you put the keys and values using the <code>=&gt;</code> symbol: <code>key =&gt; value</code>.</li>

<li>To pull values out of a hash you put the key inside <code>[ ]</code>.</li>
</ul>
<div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>
<p>Grab the code for the session:</p>

<pre><code>git clone https://github.com/code61/ruby4.git</code></pre>
</li>

<li>
<p>With your partner work through <code>ruby4/hash_examples.rb</code>. See if you can guess what each expression will do, then test by pasting into irb.</p>
</li>

<li>
<p>If you finish early, make a start on <code>hash_exercises.rb</code>.</p>
</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="2_configuration_variables">
	

		<h2>Configuration variables</h2>
		
<p>The purpose of this next part is to add an email notification to the sign-up form you worked on last time.</p>

<h3 id="problem_where_to_store_the_password">Problem: where to store the password</h3>

<p>In the example email script you were prompted for your gmail username and password. This meant we side-stepped the issue of where to write this (sensitive) information down.</p>

<p>The problem of where in your program to store sensitive, application-specific configuration data is one that you will come across often. For example, you may want to store:</p>

<ul>
<li>An email username/password for your app.</li>

<li>Database configuration, username and passwords.</li>

<li>Amazon webservices api tokens and secret key (e.g. Amazon S3 etc.).</li>

<li>Facebook integration token and key.</li>

<li>GitHub integration token and key.</li>

<li>… tokens and keys to connect to many other services.</li>
</ul>

<p>Quite often these keys will have different values in different <em>environments</em>: you probably won’t want to use your live production database when developing or testing.</p>

<p>A tempting (but non-ideal) place to put this information is in the code in your git repository (i.e. just write them into the source code files). This is bad for a few reasons including:</p>

<ol>
<li>Anyone with access to your git repository has access to your email password etc.</li>

<li>It’s hard to manage different versions for different environment - you will need to remember to replace your development info with your production info everytime before you do a ‘git push heroku’.</li>
</ol>

<p>In general <strong>it is bad practice to put passwords/tokens/keys in your git repo</strong>.</p>

<h3 id="using_env_variables">Using ENV variables</h3>

<p>A good solution for this situation is to use environment variables. All ruby programs have access to an <code>ENV</code> hash containing options from the environment where the program is run. You can see the environment variables set on your computer by running</p>

<pre><code>$ env
TERM_PROGRAM=Apple_Terminal
SHELL=/bin/bash
TERM=xterm-256color
...</code></pre>

<p>You can then check that you can access these in irb:</p>
<div class='highlight'><pre><code class='ruby'><span class='o'>&gt;</span> <span class='no'>ENV</span><span class='o'>[</span><span class='s1'>&#39;SHELL&#39;</span><span class='o'>]</span>
<span class='c1'>#=&gt; &quot;/bin/bash&quot;</span>
</code></pre></div>
<p>We are going to store the configuration values (e.g. email username and password) as environment variables for our program. Heroku makes it easy for you to manage ENV variables on their servers, as described <a href="https://devcenter.heroku.com/articles/config-vars">here</a>. To replicate the situation on your laptop you can use a gem called <code>foreman</code>.</p>

<p>You can install <code>foreman</code> via rubygems. If you use <code>rbenv</code> (i.e. if you followed ‘The Hard Way’ installation instructions) you will then need to do a <code>rbenv rehash</code>. (This is because the foreman gem comes with a command line tool, which we need to tell rbenv about.)</p>

<pre><code>gem install foreman
rbenv rehash</code></pre>

<p>Foreman manages your app processes for you. It becomes more useful when you might have several services that you need to remember to start for you application e.g. a Mongo database, a web server, a queue manager etc. We will be using it mainly to set environment variables.</p>

<p>To run your app with foreman you need to create a <code>Procfile</code> with the command you usually use to start your app (e.g. <code>ruby app.rb</code>):</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># in Procfile</span>
<span class='ss'>app</span><span class='p'>:</span>  <span class='n'>ruby</span> <span class='n'>app</span><span class='o'>.</span><span class='n'>rb</span>
</code></pre></div>
<p>To start your app you then run</p>

<pre><code>$ foreman start</code></pre>

<p>(instead of the usual <code>ruby app.rb</code>). To set the environment variables you use a <code>.env</code> file:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># in .env</span>
<span class='no'>GMAIL_USER_NAME</span><span class='o'>=</span><span class='n'>yourgmailusername</span>
<span class='no'>GMAIL_PASSWORD</span><span class='o'>=</span><span class='n'>password12345</span>
</code></pre></div>
<p>You can then access these variables in your ruby program by the <code>ENV</code> hash:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>user_name</span> <span class='o'>=</span> <span class='no'>ENV</span><span class='o'>[</span><span class='s1'>&#39;GMAIL_USER_NAME&#39;</span><span class='o'>]</span>
<span class='n'>password</span> <span class='o'>=</span> <span class='no'>ENV</span><span class='o'>[</span><span class='s1'>&#39;GMAIL_PASSWORD&#39;</span><span class='o'>]</span>
</code></pre></div>
<p>In order to keep your <code>.env</code> configuration secret you need to make sure it doesn’t get added to the git repo. If you want to deploy to Heroku, it is also important that your <code>Procfile</code> <strong>isn’t</strong> in your git repo (otherwise it will mess with Heroku’s settings when it gets up there). To do this you need to make sure both of them are in your <code>.gitignore</code>:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># in .gitignore</span>
<span class='no'>Procfile</span>
<span class='o'>.</span><span class='n'>env</span>
</code></pre></div><div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>
<p>Fetch down the changes to <code>mongo1</code>. In the <code>mongo1</code> directory:</p>

<pre><code> $ git fetch</code></pre>
</li>

<li>
<p>Checkout the <code>email</code> branch:</p>

<pre><code> $ git checkout email</code></pre>

<p>This has the solution from last time along with some email examples. If you spent a lot of time making your solution from last session look nice, you might instead want to merge the <code>email</code> branch into your <code>master</code> - up to you!</p>
</li>

<li>
<p>Do a <code>bundle install</code> (and a <code>rbenv rehash</code> if necessary):</p>

<pre><code> $ bundle install
 $ rbenv rehash</code></pre>
</li>

<li>
<p>Copy the contents of <code>mongo1/example_app/Procfile.sample</code> and <code>mongo1/example_app/.env.sample</code> and save them as <code>mongo1/example_app/Procfile</code> and <code>mongo1/example_app/.env</code> filling in your gmail details in <code>.env</code>.</p>
</li>

<li>
<p>Start the app with <code>foreman start</code>. Check that the app sends you a fruity email.</p>
</li>
</ol>
</div>
<h3 id="env_variables_on_heroku">ENV variables on heroku</h3>

<p>As the settings in <code>.env</code> aren’t in the git repo, they won’t be pushed to heroku. You will need to set these variables separately. Heroku makes it easy to do this. Assuming your app is already on heroku you can set environment variables as:</p>

<pre><code>    $ heroku config:set GMAIL_USER_NAME=yourgmailusername
    $ heroku config:set GMAIL_PASSWORD=password12345</code></pre>

<p>You can check the values you have set by running</p>

<pre><code>    $ heroku config</code></pre>

<p>There are other tools you can use to manage heroku configuration variables, which might be useful if you end up setting a lot of options. See <a href="https://github.com/ddollar/heroku-config">here</a> for more details.</p>

	</div>

	
	<div class="tab-pane " id="2_hashes">
	

		<h2>More about hashes</h2>
		
<p>In the last exercise you will have learnt a number of things about hashes. Here is a summary of the important points:</p>

<h3 id="accessing_and_setting_elements">Accessing and setting elements</h3>
<div class='highlight'><pre><code class='ruby'><span class='n'>h</span> <span class='o'>=</span> <span class='p'>{</span><span class='s1'>&#39;one&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>1</span><span class='p'>,</span> <span class='s1'>&#39;two&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>2</span><span class='p'>,</span> <span class='s1'>&#39;three&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>3</span><span class='p'>}</span>

<span class='n'>h</span><span class='o'>[</span><span class='s1'>&#39;one&#39;</span><span class='o'>]</span> <span class='c1'>#=&gt; 1</span>
<span class='n'>h</span><span class='o'>[</span><span class='s1'>&#39;four&#39;</span><span class='o'>]</span> <span class='c1'>#=&gt; nil</span>

<span class='n'>h</span><span class='o'>[</span><span class='s1'>&#39;five&#39;</span><span class='o'>]</span> <span class='o'>=</span> <span class='mi'>5</span>
<span class='n'>h</span><span class='o'>[</span><span class='s1'>&#39;one&#39;</span><span class='o'>]</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>.</span><span class='mi'>0</span>

<span class='n'>h</span> <span class='c1'>#=&gt; {&#39;one&#39; =&gt; 1.0, &#39;two&#39; =&gt; 2, &#39;three&#39; =&gt; 3, &#39;five&#39; =&gt; 5}</span>
</code></pre></div>
<ul>
<li>You access an element via its key: <code>h[&#39;one&#39;]</code></li>

<li>If the key isn’t in the hash this will give <code>nil</code></li>

<li>You add new elements by setting their key</li>

<li>If the key already exists its value will be updated</li>
</ul>

<h3 id="methods">Methods</h3>

<p>Hashes have a number of methods, which behave as you would expect e.g.</p>

<ul>
<li><code>length</code></li>

<li><code>empty?</code></li>

<li><code>keys</code>, <code>values</code></li>

<li><code>has_key?</code>, <code>has_value?</code></li>
</ul>

<h3 id="iterating">Iterating</h3>

<p>Just like an <code>Array</code>, you can iterate over a <code>Hash</code> using the <code>each</code> method. Unlike array iteration, in hash iteration the block accepts two parameters: the key and the value:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>h</span> <span class='o'>=</span> <span class='p'>{</span><span class='s1'>&#39;one&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>1</span><span class='p'>,</span> <span class='s1'>&#39;two&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>2</span><span class='p'>,</span> <span class='s1'>&#39;three&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>3</span><span class='p'>}</span>

<span class='n'>h</span><span class='o'>.</span><span class='n'>each</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>key</span><span class='p'>,</span> <span class='n'>value</span><span class='o'>|</span>
	<span class='nb'>puts</span> <span class='s2'>&quot;</span><span class='si'>#{</span><span class='n'>key</span><span class='si'>}</span><span class='s2'> = </span><span class='si'>#{</span><span class='n'>value</span><span class='si'>}</span><span class='s2'>&quot;</span>
<span class='k'>end</span>
</code></pre></div>
<h3 id="combining_hashes">Combining hashes</h3>

<p>Combining hashes is done by using the <code>merge</code> method. The values from the second hash are added to the first, replacing them if they already exist. You will often see this used in rails for specifying default options to a function:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># note how the first version of b gets overwritten</span>
<span class='p'>{</span><span class='s1'>&#39;a&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>1</span><span class='p'>,</span> <span class='s1'>&#39;b&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>2</span><span class='p'>}</span><span class='o'>.</span><span class='n'>merge</span><span class='p'>({</span><span class='s1'>&#39;b&#39;</span><span class='o'>=&gt;</span><span class='mi'>3</span><span class='p'>,</span> <span class='s1'>&#39;c&#39;</span><span class='o'>=&gt;</span><span class='mi'>4</span><span class='p'>})</span> <span class='c1'>#=&gt; {&#39;a&#39;=&gt;1, &#39;b&#39;=&gt;3, &#39;c&#39;=&gt;4}</span>

<span class='c1'># real life example</span>
<span class='k'>def</span> <span class='nf'>print_names</span><span class='p'>(</span><span class='n'>opts</span><span class='p'>)</span>
	<span class='n'>default_opts</span> <span class='o'>=</span> <span class='p'>{</span><span class='s1'>&#39;fancy_format&#39;</span> <span class='o'>=&gt;</span> <span class='kp'>true</span><span class='p'>,</span> <span class='s1'>&#39;max_length&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>20</span><span class='p'>}</span>

	<span class='c1'># replace the defaults with options supplied</span>
	<span class='n'>my_opts</span> <span class='o'>=</span> <span class='n'>default_opts</span><span class='o'>.</span><span class='n'>merge</span><span class='p'>(</span><span class='n'>opts</span><span class='p'>)</span> 

	<span class='k'>if</span> <span class='n'>my_opts</span><span class='o'>[</span><span class='s1'>&#39;fancy_format&#39;</span><span class='o'>]</span>
		<span class='c1'># ....</span>
	<span class='k'>end</span>

	<span class='c1'>#...</span>
<span class='k'>end</span>
</code></pre></div>
<p>The options example above is a common use of a hash in real life code.</p>

<h3 id="using_a_hash_for_counting">Using a hash for counting</h3>

<p>One special use of a hash is for counting things. The following code is an example of how to do this.</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>h</span> <span class='o'>=</span> <span class='p'>{}</span>

<span class='o'>[</span><span class='s1'>&#39;a&#39;</span><span class='p'>,</span> <span class='s1'>&#39;b&#39;</span><span class='p'>,</span> <span class='s1'>&#39;a&#39;</span><span class='p'>,</span> <span class='s1'>&#39;a&#39;</span><span class='o'>].</span><span class='n'>each</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>letter</span><span class='o'>|</span>
    <span class='k'>if</span> <span class='n'>h</span><span class='o'>.</span><span class='n'>has_key?</span><span class='p'>(</span><span class='n'>letter</span><span class='p'>)</span>
        <span class='c1'># if the letter is already in the hash, increase</span>
        <span class='c1'># its count by 1</span>
        <span class='n'>h</span><span class='o'>[</span><span class='n'>letter</span><span class='o'>]</span> <span class='o'>+=</span> <span class='mi'>1</span>
    <span class='k'>else</span> <span class='c1'># letter isn&#39;t in the hash</span>
        <span class='c1'># so put it in and set the count to 1</span>
        <span class='n'>h</span><span class='o'>[</span><span class='n'>letter</span><span class='o'>]</span> <span class='o'>=</span> <span class='mi'>1</span>
    <span class='k'>end</span>
<span class='k'>end</span>

<span class='n'>h</span> <span class='c1'>#=&gt; {&#39;a&#39; =&gt; 3, &#39;b&#39; =&gt; 1}</span>
</code></pre></div>
<p>You can make this example a bit shorter by using a hash with a <strong>default value</strong>: normally a hash will return <code>nil</code> if the key isn’t there, but we can set it up to return something else. In particular we’ll set it up to return 0:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># set up a hash with default value 0</span>
<span class='n'>h</span> <span class='o'>=</span> <span class='no'>Hash</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='mi'>0</span><span class='p'>)</span>

<span class='o'>[</span><span class='s1'>&#39;a&#39;</span><span class='p'>,</span> <span class='s1'>&#39;b&#39;</span><span class='p'>,</span> <span class='s1'>&#39;a&#39;</span><span class='p'>,</span> <span class='s1'>&#39;a&#39;</span><span class='o'>].</span><span class='n'>each</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>letter</span><span class='o'>|</span>
    <span class='n'>h</span><span class='o'>[</span><span class='n'>letter</span><span class='o'>]</span> <span class='o'>=</span> <span class='n'>h</span><span class='o'>[</span><span class='n'>letter</span><span class='o'>]</span> <span class='o'>+</span> <span class='mi'>1</span>
<span class='k'>end</span>

<span class='n'>h</span> <span class='c1'>#=&gt; {&#39;a&#39; =&gt; 3, &#39;b&#39; =&gt; 1}</span>
</code></pre></div>
<p>If the letter isn’t in the hash yet, the default value of 0 will be returned. Otherwise the current count will be returned. Either way, we just need to increase the value by 1.</p>
<div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>Open <code>hash_exercises.rb</code> in Sublime Text.</li>

<li>Work through the file fixing the functions to work as described.</li>

<li>Check your work by running <code>test_hash_exercises.rb</code> on the command line.</li>

<li>If you finish early move on to <code>array_conversion_examples.rb</code>.</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="3_email_templates">
	

		<h2>Email templates</h2>
		
<p>You might have noticed that the <code>mongo1/example_app</code> application uses an email template.</p>
<div class='highlight'><pre><code class='ruby'>  <span class='no'>Pony</span><span class='o'>.</span><span class='n'>mail</span><span class='p'>(</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='n'>email</span><span class='p'>,</span>
             <span class='ss'>:subject</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;Congratulations, you added a fruit!&quot;</span><span class='p'>,</span>
             <span class='ss'>:body</span> <span class='o'>=&gt;</span> <span class='n'>erb</span><span class='p'>(</span><span class='ss'>:email</span><span class='p'>,</span> <span class='ss'>:layout</span> <span class='o'>=&gt;</span> <span class='kp'>false</span><span class='p'>)</span>   <span class='p'>)</span>
</code></pre></div>
<p>The important bit is <code>erb(:email, :layout =&gt; false)</code>, which tells sinatra to find <code>views/email.erb</code> and run it through erb (to replace any <code>&lt;%= %&gt;</code> tags). The <code>:layout =&gt; false</code> tells sintra to skip the normal layout file: we want to send the user the raw text, not an html page! The result is then used as the email’s body.</p>

<p>The template looks like this:</p>

<pre><code>Hello there!

&lt;%= @name %&gt; is a great fruit!

Best,

The FruitApp team</code></pre>
<div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>Add a signup email to your <code>mongo1/app.rb</code> signup form from last time: when a user signs up they should be sent a welcome email as well as being sent to the thanks page.</li>

<li>(Optional extension) deploy your app to heroku.</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="3_hash_array_conversion">
	

		<h2>Arrays and back</h2>
		
<p>This page is more advanced. This stuff is sometimes useful, but don’t worry if you want to skip over it the first time through.</p>

<h3 id="converting_to_arrays_and_back">Converting to arrays and back</h3>

<p>You can convert a hash to an array using the <code>to_a</code> method and use the <code>Hash[ ]</code> syntax to convert it back:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>h</span> <span class='o'>=</span> <span class='p'>{</span><span class='s1'>&#39;a&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>1</span><span class='p'>,</span> <span class='s1'>&#39;b&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>2</span><span class='p'>}</span>

<span class='n'>h</span><span class='o'>.</span><span class='n'>to_a</span> <span class='c1'>#=&gt; [[&#39;a&#39;, 1], [&#39;b&#39;, 2]]</span>

<span class='n'>h2</span> <span class='o'>=</span> <span class='no'>Hash</span><span class='o'>[[</span><span class='s1'>&#39;a&#39;</span><span class='p'>,</span> <span class='mi'>1</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='s1'>&#39;b&#39;</span><span class='p'>,</span> <span class='mi'>2</span><span class='o'>]]</span>
</code></pre></div>
<p>The <code>Hash[ ]</code> is also useful for creating a hash from arrays of keys and values (which is surprisingly useful).</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>keys</span> <span class='o'>=</span> <span class='o'>[</span><span class='mi'>1</span><span class='p'>,</span> <span class='mi'>2</span><span class='p'>,</span> <span class='mi'>3</span><span class='o'>]</span>
<span class='n'>values</span> <span class='o'>=</span> <span class='o'>[</span><span class='s1'>&#39;one&#39;</span><span class='p'>,</span> <span class='s1'>&#39;two&#39;</span><span class='p'>,</span> <span class='s1'>&#39;three&#39;</span><span class='o'>]</span>

<span class='c1'># use Array#zip to get the arrays in the right format</span>
<span class='n'>zipped</span> <span class='o'>=</span> <span class='n'>keys</span><span class='o'>.</span><span class='n'>zip</span><span class='p'>(</span><span class='n'>values</span><span class='p'>)</span>  <span class='c1'>#=&gt; [[1, &#39;one&#39;], [2, &#39;two&#39;], [3, &#39;three&#39;]]</span>

<span class='n'>h</span> <span class='o'>=</span> <span class='no'>Hash</span><span class='o'>[</span><span class='n'>zipped</span><span class='o'>]</span>  <span class='c1'>#=&gt; {1 =&gt; &#39;one&#39;, 2 =&gt; &#39;two&#39;, 3 =&gt; &#39;three&#39;}</span>
</code></pre></div><div class='exercise alert alert-info'><strong>Task:</strong>
<p>(Optional)</p>

<ol>
<li>Work through <code>array_conversion_examples.rb</code>, copying and pasting into irb.</li>

<li>See if you can do the challenge at the end.</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="4_project">
	

		<h2>Project</h2>
		
<p>In the last few sessions we have learnt about:</p>

<ul>
<li>Responding to <code>post</code> requests and receiving data from web forms.</li>

<li>Storing data in a database and retrieving it.</li>

<li>Sending emails using ruby.</li>
</ul>

<p>Your challenge is to build a simple (web) application that uses one or more of these techniques.</p>

<p>Here are a few ideas to get started:</p>

<ul>
<li>Add a ‘Email this to a friend’ option to your FOAAS-type app:
<ul>
<li>On each of your pages add a link to a form.</li>

<li>Users enter an email address on the form and click ‘Send’.</li>

<li>The app sends a link to the page to the email address given.</li>
</ul>
</li>

<li>Make a URL shortener app (think tiny.cc):
<ul>
<li>The user enters a url and a keystring on a form and presses ‘create’.</li>

<li>Subsequently, when users visit <code>/keystring</code> they get redirected to the url.</li>
</ul>
</li>

<li>Create a mail-merge type app to send emails to those who sign up to the conding course on your langing page:
<ul>
<li>You export the signups from gmail as a <code>csv</code> file (File &gt; Export &gt; csv).</li>

<li>You save the csv in your ruby project.</li>

<li>Your ruby program reads in the data and sends a welcome email to each applicant.</li>
</ul>
</li>
</ul>

<p>The key thing here is to <strong>keep it simple</strong> - you only have until Tuesday to work on this: try and get something working!</p>
<div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>Choose a project to work on, either on your own or with a friend, to practice the techniques listed above.</li>

<li>Set up your project on github. It should be in a repository called <code>cfg_project1</code>.</li>

<li>Make it go!</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="4_symbols">
	

		<h2>Symbols</h2>
		
<p>Symbols are a bit like strings that can’t be changed. They’re primarily used to save space and time:</p>

<ul>
<li>Every time you write a string in ruby it has to store a new copy of it in case it is changed.</li>

<li>Every time you compare two strings it has to check every letter to see if they’re the same.</li>

<li>As symbols can’t be changed, it allows ruby to only store them once.</li>

<li>This makes it quick to compare, as you can just check to see if it’s in the same storage location.</li>
</ul>

<p>So far we’ve used strings for our hash keys. As we write and compare hash keys a lot, it makes sense to use symbols instead.</p>
<div class='highlight'><pre><code class='ruby'><span class='s2'>&quot;hello&quot;</span>
<span class='ss'>:hello</span>
</code></pre></div><div class='highlight'><pre><code class='ruby'><span class='ss'>:hello</span><span class='o'>.</span><span class='n'>to_s</span>
<span class='s2'>&quot;hello&quot;</span><span class='o'>.</span><span class='n'>to_sym</span>


<span class='s2'>&quot;hello&quot;</span> <span class='o'>&lt;&lt;</span> <span class='s2'>&quot; world&quot;</span>
<span class='ss'>:hello</span> <span class='o'>&lt;&lt;</span> <span class='ss'>:&quot; world&quot;</span>

<span class='s2'>&quot;hello&quot;</span><span class='o'>.</span><span class='n'>object_id</span>

<span class='ss'>:hello</span><span class='o'>.</span><span class='n'>object_id</span>
</code></pre></div><div class='exercise alert alert-info'><strong>Task:</strong>
<p>(Optional)</p>

<ol>
<li>Do <code>ruby4/symbolize_keys.rb</code>.</li>

<li>Test your answers using <code>test_symbolize_keys.rb</code></li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="5_wrapping_up">
	

		<h2>Rounding up</h2>
		
<p>Today we learnt about hashes (and symbols). Hashes are really important and we’ll be using them heavily from now on. The following methods are the ones you will use the most. Make sure you know them by heart and how to use them:</p>

<ul>
<li><code>h[key]</code>, <code>h[key]=</code></li>

<li><code>keys</code>, <code>values</code></li>

<li><code>has_key?</code>, <code>has_value?</code></li>

<li><code>each</code></li>

<li><code>select</code></li>
</ul>

<p>You can find out more about all the different hash methods by browing the <a href="http://www.ruby-doc.org/core-1.9.3/Hash.html">ruby hash docs</a> (to find this just Google ‘ruby hash’).</p>
<div class='exercise alert alert-info'><strong>Task:</strong>
<ol>
<li>
<p>Run <code>i_have_a_dream.rb</code> from the command line:</p>

<pre><code> ruby i_have_a_dream.rb</code></pre>

<p>Have a look at the file <code>index.html</code> it created using chrome.</p>
</li>

<li>
<p>Fix the function <code>frequencies</code> in <code>i_have_a_dream.rb</code> so it works as stated. You can test your solution using <code>test_i_have_a_dream.rb</code>. Have a look at the <code>index.html</code> that your new version creates.</p>
</li>

<li>
<p>Fix the function <code>remove_stop_words</code> in <code>i_have_a_dream.rb</code>. You can test your solution using <code>test_i_have_a_dream.rb</code>. Have a look at the <code>index.html</code> that your new version creates.</p>
</li>
</ol>
</div>
<h3 id="quick_explanation_of_i_have_a_dream">Quick explanation of I have a dream</h3>

<p>I have a dream is a program that reads in a file and produces an html word cloud.</p>

<ul>
<li>The function <code>text</code> reads in the text from <code>i_have_a_dream.txt</code> and removes all punctuation.</li>

<li>The function <code>frequencies</code> is meant to count the words using a hash.</li>

<li>The function <code>remove_stop_words</code> should filter out common english words like ‘a’ and ‘the’.</li>

<li>The function <code>write_html</code> takes the filtered words and frequencies and writes them into the html template <code>index.html.erb</code>.</li>

<li>In that file there is some javascript that generates the tag cloud, using a library called <a href="http://d3js.org/">d3.js</a></li>
</ul>

<p>Feel free to poke around with stuff. If you commit all your changes using git, you should always be able to get back to a working version!</p>

	</div>

</div>

</div>




  </div> <!-- /container -->


</body>
</html>
